<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Guardians - åŒ…æ‹¬çš„å‹•ä½œæ¤œè¨¼</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .mini-canvas {
            border: 1px solid #ccc;
            margin: 10px 0;
        }
        .tile-info {
            font-family: monospace;
            font-size: 12px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Crystal Guardians - åŒ…æ‹¬çš„å‹•ä½œæ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </h1>
    
    <div class="test-container">
        <h2>ğŸ® æ¤œè¨¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
        <button onclick="runAllTests()">å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="runTileDisplayTest()">ã‚¿ã‚¤ãƒ«è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</button>
        <button onclick="runMapLoadTest()">ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="runMinimapTest()">ãƒŸãƒ‹ãƒãƒƒãƒ—ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
    </div>

    <div id="results" class="test-grid"></div>

    <!-- ã‚²ãƒ¼ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã¿ -->
    <script src="js/grid.js"></script>
    <script src="js/minimap.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/stages.js"></script>
    <script src="js/characters.js"></script>
    <script src="js/enemies.js"></script>
    <script src="js/game.js"></script>

    <script>
        let testResults = [];
        let gameInstance = null;
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;
        let capturedLogs = [];

        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
        console.log = function(...args) {
            capturedLogs.push({type: 'log', message: args.join(' '), timestamp: new Date().toLocaleTimeString()});
            originalConsoleLog.apply(console, args);
        };

        console.error = function(...args) {
            capturedLogs.push({type: 'error', message: args.join(' '), timestamp: new Date().toLocaleTimeString()});
            originalConsoleError.apply(console, args);
        };

        function addResult(category, test, status, message, details = null) {
            testResults.push({
                category,
                test,
                status,
                message,
                details,
                timestamp: new Date().toLocaleTimeString()
            });
            updateDisplay();
        }

        function updateDisplay() {
            const resultsDiv = document.getElementById('results');
            const categories = [...new Set(testResults.map(r => r.category))];
            
            resultsDiv.innerHTML = categories.map(category => {
                const categoryResults = testResults.filter(r => r.category === category);
                const successCount = categoryResults.filter(r => r.status === 'success').length;
                const totalCount = categoryResults.length;
                
                return `
                    <div class="test-container">
                        <h3>${category} (${successCount}/${totalCount})</h3>
                        ${categoryResults.map(result => `
                            <div class="test-result ${result.status}">
                                <strong>${result.test}</strong><br>
                                ${result.message}<br>
                                <small>${result.timestamp}</small>
                                ${result.details ? `<div class="tile-info">${result.details}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
            
            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚‚è¡¨ç¤º
            if (capturedLogs.length > 0) {
                resultsDiv.innerHTML += `
                    <div class="test-container">
                        <h3>ğŸ“‹ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚° (${capturedLogs.length}ä»¶)</h3>
                        ${capturedLogs.slice(-20).map(log => `
                            <div class="test-result ${log.type === 'error' ? 'error' : 'info'}">
                                <strong>${log.type.toUpperCase()}</strong><br>
                                ${log.message}<br>
                                <small>${log.timestamp}</small>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        function clearResults() {
            testResults = [];
            capturedLogs = [];
            updateDisplay();
        }

        // 1. ã‚¿ã‚¤ãƒ«è¡¨ç¤ºãƒ†ã‚¹ãƒˆï¼ˆå¼·åŒ–ç‰ˆï¼‰
        function runTileDisplayTest() {
            addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', 'ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info', 'ã‚¿ã‚¤ãƒ«è¡¨ç¤ºã®è©³ç´°æ¤œè¨¼ã‚’é–‹å§‹ã—ã¾ã™');
            
            try {
                // PANEL_TYPESå®šæ•°ã®ç¢ºèª
                if (typeof PANEL_TYPES !== 'undefined') {
                    addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', 'PANEL_TYPESç¢ºèª', 'success', 
                        'PANEL_TYPESå®šæ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™', 
                        `PANEL_TYPES: ${JSON.stringify(PANEL_TYPES, null, 2)}`);
                } else {
                    addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', 'PANEL_TYPESç¢ºèª', 'error', 'PANEL_TYPESå®šæ•°ãŒæœªå®šç¾©ã§ã™');
                    return;
                }

                // GridSystemã‚¯ãƒ©ã‚¹ã®ç¢ºèª
                if (typeof GridSystem !== 'undefined') {
                    addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', 'GridSystemã‚¯ãƒ©ã‚¹ç¢ºèª', 'success', 'GridSystemã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™');
                } else {
                    addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', 'GridSystemã‚¯ãƒ©ã‚¹ç¢ºèª', 'error', 'GridSystemã‚¯ãƒ©ã‚¹ãŒæœªå®šç¾©ã§ã™');
                    return;
                }
                
                // å„ãƒãƒƒãƒ—ã®ã‚¿ã‚¤ãƒ«æ¤œè¨¼
                for (let mapNum = 1; mapNum <= 3; mapNum++) {
                    addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}æ¤œè¨¼é–‹å§‹`, 'info', `ãƒãƒƒãƒ—${mapNum}ã®è©³ç´°æ¤œè¨¼ã‚’é–‹å§‹ã—ã¾ã™`);
                    
                    // ã‚¹ãƒ†ãƒƒãƒ—1: GridSystemã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                    let testGrid;
                    try {
                        testGrid = new GridSystem(mapNum);
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ`, 'success', 'GridSystemã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚Œã¾ã—ãŸ');
                    } catch (constructorError) {
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ`, 'error', 
                            `ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¨ãƒ©ãƒ¼: ${constructorError.message}`);
                        continue;
                    }
                    
                    // ã‚¹ãƒ†ãƒƒãƒ—2: ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®ç›´æ¥ç¢ºèª
                    let rawMapData;
                    try {
                        rawMapData = testGrid.getMapData(mapNum);
                        if (rawMapData && rawMapData.length > 0) {
                            addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ç”Ÿãƒ‡ãƒ¼ã‚¿å–å¾—`, 'success', 
                                `ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: ${rawMapData.length}è¡Œ Ã— ${rawMapData[0]?.length || 0}åˆ—`, 
                                `ç”Ÿãƒ‡ãƒ¼ã‚¿å†…å®¹:\n${rawMapData.map((row, y) => `Row ${y}: [${row.join(', ')}]`).join('\n')}`);
                        } else {
                            addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ç”Ÿãƒ‡ãƒ¼ã‚¿å–å¾—`, 'error', 'ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ãŒç©ºã¾ãŸã¯æœªå®šç¾©ã§ã™');
                            continue;
                        }
                    } catch (dataError) {
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ç”Ÿãƒ‡ãƒ¼ã‚¿å–å¾—`, 'error', 
                            `ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ${dataError.message}`);
                        continue;
                    }
                    
                    // ã‚¹ãƒ†ãƒƒãƒ—3: charToTypeãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆ
                    try {
                        const charTests = ['S', 'G', '-', '.', 'R', 'W'];
                        const charResults = charTests.map(char => {
                            const result = testGrid.charToType(char);
                            return `'${char}' â†’ '${result}'`;
                        });
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}æ–‡å­—å¤‰æ›`, 'success', 
                            'æ–‡å­—å¤‰æ›ãƒ†ã‚¹ãƒˆå®Œäº†', `å¤‰æ›çµæœ:\n${charResults.join('\n')}`);
                    } catch (charError) {
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}æ–‡å­—å¤‰æ›`, 'error', 
                            `æ–‡å­—å¤‰æ›ã‚¨ãƒ©ãƒ¼: ${charError.message}`);
                    }
                    
                    // ã‚¹ãƒ†ãƒƒãƒ—4: ã‚°ãƒªãƒƒãƒ‰çŠ¶æ…‹ã®ç¢ºèª
                    let typeCounts = {};
                    let tileDetails = [];
                    let debugGrid = [];
                    let gridCheckSuccess = true;
                    
                    try {
                        for (let y = 0; y < 8; y++) {
                            debugGrid[y] = [];
                            for (let x = 0; x < 11; x++) {
                                const panel = testGrid.getPanel(x, y);
                                if (panel) {
                                    debugGrid[y][x] = panel.type;
                                    typeCounts[panel.type] = (typeCounts[panel.type] || 0) + 1;
                                    
                                    // é‡è¦ãªã‚¿ã‚¤ãƒ«ã®ä½ç½®ã‚’è¨˜éŒ²
                                    if (panel.type === 'start' || panel.type === 'goal' || panel.type === 'rock' || panel.type === 'water') {
                                        tileDetails.push(`${panel.type}(${x},${y})`);
                                    }
                                } else {
                                    debugGrid[y][x] = 'NULL';
                                    gridCheckSuccess = false;
                                }
                            }
                        }
                        
                        if (gridCheckSuccess) {
                            addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ã‚°ãƒªãƒƒãƒ‰ç¢ºèª`, 'success', 'ã‚°ãƒªãƒƒãƒ‰çŠ¶æ…‹ã®ç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸ');
                        } else {
                            addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ã‚°ãƒªãƒƒãƒ‰ç¢ºèª`, 'warning', 'ã‚°ãƒªãƒƒãƒ‰ã«NULLãƒ‘ãƒãƒ«ãŒå­˜åœ¨ã—ã¾ã™');
                        }
                    } catch (gridError) {
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ã‚°ãƒªãƒƒãƒ‰ç¢ºèª`, 'error', 
                            `ã‚°ãƒªãƒƒãƒ‰ç¢ºèªã‚¨ãƒ©ãƒ¼: ${gridError.message}`);
                        continue;
                    }
                    
                    const detailsText = `ã‚¿ã‚¤ãƒ—åˆ¥ã‚«ã‚¦ãƒ³ãƒˆ: ${JSON.stringify(typeCounts, null, 2)}\né‡è¦ã‚¿ã‚¤ãƒ«: ${tileDetails.join(', ')}\n\nã‚°ãƒªãƒƒãƒ‰çŠ¶æ…‹:\n${debugGrid.map((row, y) => `Row ${y}: [${row.join(', ')}]`).join('\n')}`;
                    
                    // ã‚¹ãƒ†ãƒƒãƒ—5: loadMapãƒ¡ã‚½ãƒƒãƒ‰ã‚’å†åº¦å‘¼ã³å‡ºã—ã¦ãƒ†ã‚¹ãƒˆ
                    try {
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}å†èª­ã¿è¾¼ã¿`, 'info', 'loadMapãƒ¡ã‚½ãƒƒãƒ‰ã‚’å†å®Ÿè¡Œã—ã¾ã™');
                        testGrid.loadMap(mapNum);
                        
                        // å†èª­ã¿è¾¼ã¿å¾Œã®çŠ¶æ…‹ç¢ºèª
                        let reloadTypeCounts = {};
                        for (let y = 0; y < 8; y++) {
                            for (let x = 0; x < 11; x++) {
                                const panel = testGrid.getPanel(x, y);
                                if (panel) {
                                    reloadTypeCounts[panel.type] = (reloadTypeCounts[panel.type] || 0) + 1;
                                }
                            }
                        }
                        
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}å†èª­ã¿è¾¼ã¿å¾Œ`, 'success', 
                            'å†èª­ã¿è¾¼ã¿å¾Œã®çŠ¶æ…‹ç¢ºèªå®Œäº†', `å†èª­ã¿è¾¼ã¿å¾Œã‚¿ã‚¤ãƒ—åˆ¥ã‚«ã‚¦ãƒ³ãƒˆ: ${JSON.stringify(reloadTypeCounts, null, 2)}`);
                    } catch (reloadError) {
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}å†èª­ã¿è¾¼ã¿`, 'error', 
                            `å†èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${reloadError.message}`);
                    }
                    
                    // ã‚¹ãƒ†ãƒƒãƒ—6: å¿…é ˆã‚¿ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
                    if (typeCounts['start'] && typeCounts['goal']) {
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ã‚¿ã‚¤ãƒ«é…ç½®`, 'success', 
                            `ã‚¹ã‚¿ãƒ¼ãƒˆ: ${typeCounts['start']}å€‹, ã‚´ãƒ¼ãƒ«: ${typeCounts['goal']}å€‹`, detailsText);
                    } else {
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}ã‚¿ã‚¤ãƒ«é…ç½®`, 'error', 
                            'ã‚¹ã‚¿ãƒ¼ãƒˆã¾ãŸã¯ã‚´ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', detailsText);
                    }
                    
                    // ã‚¹ãƒ†ãƒƒãƒ—7: æç”»ãƒ†ã‚¹ãƒˆ
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = 11 * 64;
                        canvas.height = 8 * 64;
                        const ctx = canvas.getContext('2d');
                        
                        testGrid.render(ctx);
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}æç”»`, 'success', 'æç”»å‡¦ç†ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ');
                        
                        // ãƒŸãƒ‹ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’çµæœã«è¿½åŠ 
                        canvas.className = 'mini-canvas';
                        canvas.style.width = '220px';
                        canvas.style.height = '160px';
                        canvas.title = `ãƒãƒƒãƒ—${mapNum}ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼`;
                        
                    } catch (renderError) {
                        addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', `ãƒãƒƒãƒ—${mapNum}æç”»`, 'error', 
                            `æç”»ã‚¨ãƒ©ãƒ¼: ${renderError.message}`);
                    }
                }
                
            } catch (error) {
                addResult('ğŸ¨ ã‚¿ã‚¤ãƒ«è¡¨ç¤º', 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼', 'error', `äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // 2. ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        function runMapLoadTest() {
            addResult('ğŸ—ºï¸ ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿', 'ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info', 'ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿æ¤œè¨¼ã‚’é–‹å§‹ã—ã¾ã™');
            
            try {
                for (let mapNum = 1; mapNum <= 3; mapNum++) {
                    const gridSystem = new GridSystem();
                    const mapData = gridSystem.getMapData(mapNum);
                    
                    if (mapData && mapData.length === 8 && mapData[0].length === 11) {
                        addResult('ğŸ—ºï¸ ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿', `ãƒãƒƒãƒ—${mapNum}ãƒ‡ãƒ¼ã‚¿`, 'success', 
                            `æ­£å¸¸ãªã‚µã‚¤ã‚º: ${mapData.length}è¡Œ Ã— ${mapData[0].length}åˆ—`);
                        
                        // ãƒãƒƒãƒ—ã®å†…å®¹æ¤œè¨¼
                        let hasStart = false, hasGoal = false, hasRoad = false;
                        for (let row of mapData) {
                            for (let cell of row) {
                                if (cell === 'S') hasStart = true;
                                if (cell === 'G') hasGoal = true;
                                if (cell === '-') hasRoad = true;
                            }
                        }
                        
                        if (hasStart && hasGoal && hasRoad) {
                            addResult('ğŸ—ºï¸ ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿', `ãƒãƒƒãƒ—${mapNum}å†…å®¹`, 'success', 
                                'ã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚´ãƒ¼ãƒ«ã€é“è·¯ãŒæ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ã¾ã™');
                        } else {
                            addResult('ğŸ—ºï¸ ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿', `ãƒãƒƒãƒ—${mapNum}å†…å®¹`, 'warning', 
                                `ä¸å®Œå…¨ãªãƒãƒƒãƒ—: S=${hasStart}, G=${hasGoal}, Road=${hasRoad}`);
                        }
                        
                    } else {
                        addResult('ğŸ—ºï¸ ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿', `ãƒãƒƒãƒ—${mapNum}ãƒ‡ãƒ¼ã‚¿`, 'error', 
                            'ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®ã‚µã‚¤ã‚ºãŒä¸æ­£ã§ã™');
                    }
                }
                
            } catch (error) {
                addResult('ğŸ—ºï¸ ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿', 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼', 'error', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // 3. ãƒŸãƒ‹ãƒãƒƒãƒ—ãƒ†ã‚¹ãƒˆ
        function runMinimapTest() {
            addResult('ğŸ—ºï¸ ãƒŸãƒ‹ãƒãƒƒãƒ—', 'ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info', 'ãƒŸãƒ‹ãƒãƒƒãƒ—æ©Ÿèƒ½ã®æ¤œè¨¼ã‚’é–‹å§‹ã—ã¾ã™');
            
            try {
                // ãƒŸãƒ‹ãƒãƒƒãƒ—ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ä½œæˆ
                const miniCanvas = document.createElement('canvas');
                miniCanvas.id = 'miniMapCanvas';
                miniCanvas.width = 200;
                miniCanvas.height = 150;
                document.body.appendChild(miniCanvas);
                
                // ä»®ã®ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
                const mockGame = {
                    gridSystem: new GridSystem(1),
                    characters: []
                };
                
                const miniMapRenderer = new MiniMapRenderer(mockGame);
                
                if (miniMapRenderer.canvas && miniMapRenderer.ctx) {
                    addResult('ğŸ—ºï¸ ãƒŸãƒ‹ãƒãƒƒãƒ—', 'ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–', 'success', 'ãƒŸãƒ‹ãƒãƒƒãƒ—ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
                    
                    // åŸºæœ¬æç”»ãƒ†ã‚¹ãƒˆ
                    miniMapRenderer.drawBasicMiniMap();
                    addResult('ğŸ—ºï¸ ãƒŸãƒ‹ãƒãƒƒãƒ—', 'åŸºæœ¬æç”»', 'success', 'åŸºæœ¬ãƒŸãƒ‹ãƒãƒƒãƒ—ã®æç”»ãŒå®Œäº†ã—ã¾ã—ãŸ');
                    
                    // ãƒ«ãƒ¼ãƒˆè¡¨ç¤ºãƒ†ã‚¹ãƒˆ
                    miniMapRenderer.showRoute('ground');
                    addResult('ğŸ—ºï¸ ãƒŸãƒ‹ãƒãƒƒãƒ—', 'åœ°ä¸Šãƒ«ãƒ¼ãƒˆè¡¨ç¤º', 'success', 'åœ°ä¸Šãƒ«ãƒ¼ãƒˆã®è¡¨ç¤ºãŒå®Œäº†ã—ã¾ã—ãŸ');
                    
                    miniMapRenderer.showRoute('air');
                    addResult('ğŸ—ºï¸ ãƒŸãƒ‹ãƒãƒƒãƒ—', 'ç©ºä¸­ãƒ«ãƒ¼ãƒˆè¡¨ç¤º', 'success', 'ç©ºä¸­ãƒ«ãƒ¼ãƒˆã®è¡¨ç¤ºãŒå®Œäº†ã—ã¾ã—ãŸ');
                    
                } else {
                    addResult('ğŸ—ºï¸ ãƒŸãƒ‹ãƒãƒƒãƒ—', 'ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–', 'error', 'ãƒŸãƒ‹ãƒãƒƒãƒ—ã‚­ãƒ£ãƒ³ãƒã‚¹ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                document.body.removeChild(miniCanvas);
                
            } catch (error) {
                addResult('ğŸ—ºï¸ ãƒŸãƒ‹ãƒãƒƒãƒ—', 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼', 'error', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // 4. å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function runAllTests() {
            clearResults();
            addResult('ğŸ” ç·åˆãƒ†ã‚¹ãƒˆ', 'é–‹å§‹', 'info', 'å…¨ã¦ã®æ¤œè¨¼ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™');
            
            setTimeout(() => runTileDisplayTest(), 100);
            setTimeout(() => runMapLoadTest(), 500);
            setTimeout(() => runMinimapTest(), 1000);
            
            setTimeout(() => {
                const totalTests = testResults.length;
                const successTests = testResults.filter(r => r.status === 'success').length;
                const errorTests = testResults.filter(r => r.status === 'error').length;
                
                addResult('ğŸ” ç·åˆãƒ†ã‚¹ãƒˆ', 'å®Œäº†', 
                    errorTests === 0 ? 'success' : 'warning', 
                    `æˆåŠŸ: ${successTests}, ã‚¨ãƒ©ãƒ¼: ${errorTests}, ç·è¨ˆ: ${totalTests}`);
            }, 1500);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            addResult('ğŸ” ã‚·ã‚¹ãƒ†ãƒ ', 'åˆæœŸåŒ–', 'info', 'æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸ');
        });
    </script>
</body>
</html> 